# Entity Framework

[Entity Framework 6](https://docs.microsoft.com/en-us/ef/ef6/) è uno strumento molto potente che integrandosi perfettamente all'interno di progetti .NET consente di gestire interamente l'accesso al database in maniera efficente, intelligente e quasi trasparente al programmatore. Esso è pertanto un **framework di persistenza** e in quanto tale implementa nativamente svariati pattern architetturali che fra poco analizzeremo.

### LINQ

Entity Framework non lavora da solo, bensì integra il suo funzionamento con un'altra componente molto importante di casa Microsoft che prende il nome di [LINQ](https://docs.microsoft.com/it-it/dotnet/csharp/programming-guide/concepts/linq/) e mette a disposizione importantissimi metodi per l'interrogazione e la gestione delle [Collection](https://docs.microsoft.com/it-it/dotnet/csharp/programming-guide/concepts/collections) (array, liste, mappe, insiemi, ...).

Dalla fusione tra la potenza di LINQ e quella di Entity Framework nasce [LINQ to SQL](https://docs.microsoft.com/it-it/dotnet/framework/data/adonet/sql/linq/), una tecnologia che permette di utilizzare dei _Metodi_ (tipici di un linguaggio orientato agli oggetti come C#) per effettuare delle _Query SQL_, che vengono prodotte in maniera del tutto trasparente. Ciò rende possibile l'interrogazione di un database gestito da Entity Framework tramite comode funzioni LINQ, in maniera del tutto indipendente dal [DBSM](https://it.wikipedia.org/wiki/Database_management_system).

LINQ to SQL implementa di fatto un **[Query Object Pattern](https://martinfowler.com/eaaCatalog/queryObject.html)**, che si concretizza nell'interfaccia generica `IQueryable`.

Riportiamo qui sotto un esempio che si occupa di eseguire una `WHERE` sulla tabella `Stocks` e successivamente una `SELECT SUM(Quantity)`
```
var ingredientStocks = db.Stocks.Where(x => x.IngredientId == element.IngredientId && 
                                            x.ExpireDate >= DateTime.Now &&
                                            x.Quantity > 0); // lista scorte (disponibili) per questo ingrediente

int? ownedQuantity = ingredientStocks.Select(x => x.Quantity)
                                     .DefaultIfEmpty(0).Sum(); // quantità di questo ingrediente presente in magazzino
```

## Entity Framework Pattern

Come già accennato, EF è un framework di persistenza che sfrutta numerosi pattern architetturali. Non tutti sono usati da Entity Framework in maniera classica, spesso sono mixati tra loro e alcuni di essi sono implementabili tramite specifici comportamenti da parte del programmatore. Provvediamo quindi a fornire un elenco completo di tutti i pattern che EF _utilizza_, _simula_ o con cui _è possibile_ utilizzarlo, per poi andare a descriverli singolarmente.

* [Table Module](https://martinfowler.com/eaaCatalog/tableModule.html)
* [Record Set](https://martinfowler.com/eaaCatalog/recordSet.html)
* [Data Mapper](https://martinfowler.com/eaaCatalog/dataMapper.html)
* [Inheritance Mappers](https://martinfowler.com/eaaCatalog/inheritanceMappers.html)


* [Identity Field](https://martinfowler.com/eaaCatalog/identityField.html)
* [Foreign Key Mapping](https://martinfowler.com/eaaCatalog/foreignKeyMapping.html)
* [Association Table Mapping](https://martinfowler.com/eaaCatalog/associationTableMapping.html)


* [Lazy Load](https://martinfowler.com/eaaCatalog/lazyLoad.html)
* [Unit of Work](https://martinfowler.com/eaaCatalog/unitOfWork.html)


* [Repository](https://martinfowler.com/eaaCatalog/repository.html)
* [Service Layer](https://martinfowler.com/eaaCatalog/serviceLayer.html)





