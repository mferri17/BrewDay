@model BrewDay.Domain.Entities.Recipe

@{
    ViewBag.Title = "Details";
    string a = null;
    ViewBag.IngredientRecipe = Model.RecipeId;
}

<h2>
    Dettagli della Ricetta @Model.Name
    <span class="help-icon glyphicon glyphicon-question-sign cursor-pointer" data-toggle="modal" data-target="#help-modal"
          data-header="Configuratore di Ricette" data-body="Qui è possibile gestire gli Ingredienti precedentemente aggiunti alla Ricetta"></span>
</h2>

@if (TempData.ContainsKey("Message"))
{
    <div id="message" class="alert alert-danger">@TempData["Message"]</div>
}

<hr />
<a href="@Url.Action("Edit", new { id = Model.RecipeId })" class="btn btn-primary pull-right">Modifica</a>
<dl class="dl-horizontal">
    <dt> Padre</dt>
    <dd> <a href="/Recipes/Details/@Model.ParentRecipeId">@(Model.ParentRecipe?.FullName)</a> @*@Html.ActionLink(Model.ParentRecipe?.Name ?? "", "Details", new { id = Model?.ParentRecipeId })*@ </dd>

    <dt>@Html.DisplayNameFor(model => model.Name) </dt>
    <dd>@Html.DisplayFor(model => model.Name)</dd>

    <dt> @Html.DisplayNameFor(model => model.Description) </dt>
    <dd> @Html.DisplayFor(model => model.Description)</dd>

    <dt> @Html.DisplayNameFor(model => model.Note) </dt>
    <dd> @Html.DisplayFor(model => model.Note)</dd>

    <dt> @Html.DisplayNameFor(model => model.FermentationTemperature) </dt>
    <dd> @Html.DisplayFor(model => model.FermentationTemperature) </dd>
</dl>

<ul class="nav nav-tabs" role="tablist">
    <li role="presentation" class="active"><a href="#Ingredient" aria-controls="Ingredient" role="tab" data-toggle="tab">Ingredienti</a></li>
    <li role="presentation"><a href="#Production" aria-controls="Production" role="tab" data-toggle="tab">Produzioni</a></li>
    <li role="presentation"><a href="#Clone" aria-controls="Clone" role="tab" data-toggle="tab">Varianti</a></li>
</ul>


<div class="tab-content">
    <div role="tabpanel" class="tab-pane active" id="Ingredient">
        <table class="table table-bordered table-striped table-hover full-width">
            <thead>
                <tr>
                    <th>@Html.DisplayNameFor(model => model.Ingredients)</th>
                    <th>Quantità</th>
                    <th></th>
                </tr>

            </thead>
            <tbody>
                @foreach (var item in Model.Ingredients)
                {
                    <tr>
                        <td>@Html.DisplayFor(modelItem => item.Ingredient.FullName)</td>
                        <td>
                            @Html.DisplayFor(modelItem => item.Quantity)
                            <a href="@Url.Action("Create", "Stocks", new {ingredientId = item.IngredientId })" data-toggle="tooltip" title="Aggiungimi alle Scorte" data-placement="right"><span class="glyphicon glyphicon-plus"></span></a>
                        </td>
                        <td>
                            <a href=@Url.Action("RemoveIngredient", new { recipeId = Model.RecipeId, ingredientId = item.IngredientId })><span class="glyphicon glyphicon-trash pull-left" data-toggle="tooltip" title="Rimuovimi dalla Ricetta" data-placement="right" style="margin-left:15px"></span></a>
                            <a href=@Url.Action("Details", "Ingredients", new {Id = item.IngredientId })><span class="glyphicon glyphicon-info-sign pull-right" data-toggle="tooltip" title="Info sull'Ingrediente" data-placement="left" style="margin-right:15px"></span></a>
                        </td>
                    </tr>
                }
            </tbody>

        </table>
        <a href="@Url.Action("AddIngredient", new { id = Model.RecipeId })" class="btn btn-primary media-middle">Aggiungi Ingrediente</a>
    </div>

    <div role="tabpanel" class="tab-pane" id="Production">
        @if (Model.Productions.FirstOrDefault() != null)
        {
        <table class="table table-bordered table-striped table-hover full-width">
            <thead>
                <tr>
                    <th>@Html.DisplayNameFor(model => model.Productions.FirstOrDefault().DateStart)</th>
                    <th>@Html.DisplayNameFor(model => model.Productions.FirstOrDefault().DateEndEstimated)</th>
                    <th>@Html.DisplayNameFor(model => model.Productions.FirstOrDefault().DateEnd)</th>
                    <th>Quantità</th>
                    <th></th>
                </tr>

            </thead>
            <tbody>
                @foreach (var item in Model.Productions)
            {
                <tr>
                    <td>@Html.DisplayFor(modelItem => item.DateStart)</td>
                    <td>@Html.DisplayFor(modelItem => item.DateEndEstimated)</td>
                    <td>@Html.DisplayFor(modelItem => item.DateEnd)</td>
                    <td>
                        <a href=@Url.Action("Stop", "Production", new { recipeId = Model.RecipeId, ingredientId = item.ProductionId }) data-toggle="tooltip" title="Concludi Produzione" data-placement="left"><span class="glyphicon glyphicon-minus-sign pull-left" style="margin-left:15px"></span></a>
                        <a href=@Url.Action("Details", "Production", new { Id = item.ProductionId }) data-toggle="tooltip" title="Info sulla Produzione" data-placement="right"><span class="glyphicon glyphicon-info-sign pull-right" style="margin-right:15px"></span></a>
                    </td>
                </tr>
                }
            </tbody>
        </table>
        }
        @if (Model.Productions.FirstOrDefault() == null) { 
        <h3>La ricetta Selezionata non è mai stata mandata in Produzione</h3>
        }

        <div class="row col-md-12">
            <form action="/Productions/Play" class="pull-left">
                <label>Quantità</label>
                <input type="hidden" name="recipeId" value="@Model.RecipeId" />
                <input type="number" name="qty" class="form-control" />
                <p></p>
                <input type="submit" class="btn btn-default btn-success pull-left" value="Manda in Produzione la Ricetta" />
            </form>
        </div>
    </div>


    <div role="tabpanel" class="tab-pane" id="Clone">

        <div class="row col-md-12">
            <form action="/Recipes/Clone">
                <input type="hidden" name="id" value="@Model.RecipeId" />
                <input type="hidden" name="name" value="@Model.Name" />
                <input type="submit" data-toggle="tooltip" title="Realizza una Variazione della Ricetta Corrente !" data-placement="left" class="btn btn-default btn-success pull-left" value="Clicca per Creare una Variante" />
            </form>
            </div>
        </div>

    </div>

<a href="@Url.Action("Index")" class="btn btn-default pull-right">Torna indietro</a>


@section scripts{
    <script>
        $(document).ready(function () {
            $("#message").delay(3000).hide(200);
        });
    </script>

    <script>
        $(document).ready(function () {
            $('[data-toggle="tooltip"]').tooltip();
        });
    </script>

    <script>
        $('#BrewTabs a').click(function (e) {
            e.preventDefault()
            $(this).tab('show')
        })
    </script>

    <script>
        $('#BrewTabs a[href="#Ingredient"]').tab('show')
        $('#BrewTabs a[href="#Production"]').tab('show')
        $('#BrewTabs a[href="#Clone"]').tab('show')
    </script>
}
